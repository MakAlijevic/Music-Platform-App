<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SoundWave</title>
  <link href="css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="css/profile.css" />
  <link href="https://fonts.googleapis.com/css2?family=Dosis&family=Play&display=swap" rel="stylesheet">
</head>

<header>
  <nav class="navbar navbar-dark bg-transparent">
    <div class="container-fluid">
      <a class="navbar-brand ms-5" href="homepage.html" style="font-size: 1.5rem;">SoundWave</a>


      <form class="d-flex">
        <div class="position-relative w-100 mt-3">
          <input class="form-control border-0 rounded-pill w-200 ps-4 pe-5" type="text"
            placeholder="Search for a song..."
            style="height: 40px; width: 700px; background-color:#282828;color:white ">
        </div>
      </form>

      <div class="dropdown pt-3 pe-5">
        <a href="#" class="d-flex align-items-center text-white text-decoration-none dropdown-toggle" id="dropdownUser1"
          data-bs-toggle="dropdown" aria-expanded="false">
          <img src="" alt="" width="30" height="30" class="rounded-circle" id="smallphoto">
          <span class="d-none d-sm-inline mx-3" id="usernamesmall"></span>
        </a>
        <ul class="dropdown-menu dropdown-menu-dark text-small shadow">
          <li><a class="dropdown-item" href="profile.html">Profile</a></li>
          <li>
            <hr class="dropdown-divider">
          </li>
          <li><a class="dropdown-item" href="#" onClick="UserService.logout()">Sign out</a></li>
        </ul>
      </div>

    </div>
  </nav>
</header>


<body>

  <img class="rounded-circle mx-auto mt-5 d-block" id="profilepicture" width="250" height="250" src=""
    alt="profilePicture">


  <div class="pt-3" style="text-align:center">
    <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#EditProfileModal">Edit
      profile</button>
  </div>

    <div class="container">
        <h1 class="text-center mt-5" id="mainUsername" style="font-size: 5rem; font-weight: 1000;"></h1>
  </div>

  <div class="container">
        <div class="row">
            <div class="col-4 mx-auto mt-3">
                <h5 class="text-center mt-4 border-bottom">First Name</h5>
                <h5 class="text-center mt-2" id="profileFirstName" style="color:grey"></h5>
            </div>

            </div>
        <div class="row">
            <div class="col-4 mx-auto mt-3">
                <h5 class="text-center mt-4 border-bottom">Last Name</h5>
                <h5 class="text-center mt-2" id="profileLastName" style="color:grey"></h5>
            </div>
        </div>
        <div class="row">
            <div class="col-4 mx-auto mt-3">
                <h5 class="text-center mt-4 border-bottom">Username</h5>
                <h5 class="text-center mt-2" id="profileUsername" style="color:grey"></h5>
            </div>
        </div>
        <div class="row">
            <div class="col-4 mx-auto mt-3">
                <h5 class="text-center mt-4 border-bottom">Email</h5>
                <h5 class="text-center mt-2" id="profileEmail" style="color:grey"></h5>
            </div>
        </div>
        <div class="row">
            <div class="col-4 mx-auto mt-3 mb-5">
                <h5 class="text-center mt-4 border-bottom">Date of Birth</h5>
                <h5 class="text-center mt-2" id="profileDateOfBirth" style="color:grey"></h5>
            </div>
        </div>
    </div>

      <h2 class="text-center mt-5" style="font-size: 3rem;">My playlists</h2>

  <div class="container">
    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3" id="playlists">

    </div>
  </div>


  <div class="modal fade" id="AvatarModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            Close
          </button>
          <h4 class="modal-title" id="myModalLabel">Choose your avatar! </h4>
        </div>
        <div class="modal-body">
          <input type="image" id="photo1" src="avatars/female1.jpg" height="200" width="230"
            style="padding-right: 3px;padding-bottom: 3px;padding-left: 5px;" class="img" onclick="chooseAvatar(id)">
          <input type="image" id="photo2" src="avatars/female2.jpg" height="200" width="230"
            style="padding-right: 3px;padding-bottom: 3px;padding-left: 5px;" class="img" onclick="chooseAvatar(id)">
          <input type="image" id="photo3" src="avatars/female3.jpg" height="200" width="230"
            style="padding-right: 3px;padding-bottom: 3px;padding-left: 5px;" class="img" onclick="chooseAvatar(id)">
          <input type="image" id="photo4" src="avatars/male1.jpg" height="200" width="230"
            style="padding-right: 3px;padding-bottom: 3px;padding-left: 5px;" class="img" onclick="chooseAvatar(id)">
          <input type="image" id="photo5" src="avatars/male2.jpg" height="200" width="230"
            style="padding-right: 3px;padding-bottom: 3px;padding-left: 5px;" class="img" onclick="chooseAvatar(id)">
          <input type="image" id="photo6" src="avatars/male3.jpg" height="200" width="230"
            style="padding-right: 3px;padding-bottom: 3px;padding-left: 5px;" class="img" onclick="chooseAvatar(id)">

        </div>
      </div>
    </div>
  </div>
</body>

<div class="modal fade" id="EditProfileModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form class="mx-1 mx-md-4" method="post" id="registerForm">
        <div class="modal-header ms-2">
          <h5 class="modal-title w-100" id="exampleModalLabel" style="color:#DDDBF1;text-align:center;">Edit profile
          </h5>
        </div>
        <div class="modal-body">

          <img class="rounded-circle mx-auto mt-5 d-block" id="profilepictureedit" width="250" height="250" src=""
            alt="profilePicture">
          <div class="text-center">
            <button type="button" id="buttonphoto" class="btn btn-default btn-lg h-500 center-v center-h"
              data-bs-toggle="modal" data-bs-target="#AvatarModal" style="color:white;">Change Avatar</button>
          </div>

          <div class="d-flex flex-row align-items-center mb-4 pt-3">
            <i class="fas fa-user fa-lg me-3 fa-fw"></i>
            <div class="form-outline flex-fill mb-0">
              <input name="name" type="text" id="editFirstName" class="form-control" required />
              <label class="form-label w-100" for="form3Example1c" style="color:#DDDBF1;text-align:center;">Your Name</label>
            </div>
          </div>

          <div class="d-flex flex-row align-items-center mb-4">
            <i class="fas fa-envelope fa-lg me-3 fa-fw"></i>
            <div class="form-outline flex-fill mb-0">
              <input name="surname" type="text" id="editLastName" class="form-control" required />
              <label class="form-label w-100" for="form3Example3c" style="color:#DDDBF1;text-align:center;">Your Surname</label>
            </div>
          </div>

          <div class="d-flex flex-row align-items-center mb-4">
            <i class="fas fa-envelope fa-lg me-3 fa-fw"></i>
            <div class="form-outline flex-fill mb-0">
              <input type="text" id="editEmail" class="form-control" required />
              <label class="form-label w-100" for="form3Example3c" style="color:#DDDBF1;text-align:center;">Your Email</label>
            </div>
          </div>

          <div class="d-flex flex-row align-items-center mb-4">
            <i class="fas fa-envelope fa-lg me-3 fa-fw"></i>
            <div class="form-outline flex-fill mb-0">
              <input name="username" type="text" id="editUsername" class="form-control" required />
              <label class="form-label w-100" for="form3Example3c" style="color:#DDDBF1;text-align:center;">Username</label>
            </div>
          </div>

          <div class="form-group" style="color:#DDDBF1; padding: 20px;">
            <input name="dob" type="date" id="editDateOfBirth" class="form-control " placeholder="Date of Birth"
              required>
            <label class="form-label w-100" for="form3Example3c" style="color:#DDDBF1;text-align:center;">Date Of Birth</label>
          </div>
          <div class="form-group w-100" style="color:#DDDBF1; padding: 20px; text-align:center;">
            <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#deleteModal">
              Delete Profile
            </button>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
              Close
            </button>
            <button id="save" type="button" class="btn btn-primary" onclick="editProfile()">Save</button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>


<script src="javaScript/jquery-3.6.0.min.js"></script>
<script src="javaScript\bootstrap.bundle.min.js"></script>
<script src="javaScript/UserService.js"></script>
<script>
  UserService.getPhotoHomepage();
</script>

<script>
  UserService.getMainUsername();
  UserService.getFirstName();
  UserService.getLastName();
  UserService.getUsername();
  UserService.getEmail();
  UserService.getDateOfBirth();
  UserService.getPhoto();

</script>

<script>

  function chooseAvatar(id) {
    var photoid = document.getElementById(id);
    var url = photoid.getAttribute("src");
    $('#AvatarModal').modal("hide");
    $('#EditProfileModal').modal("show");
    $('#profilepictureedit').attr('src', url);
  }

  function editProfile() {
    var editUser = {};
    editUser.name = $('#editFirstName').val();
    editUser.surname = $('#editLastName').val();
    editUser.username = $('#editUsername').val();
    editUser.email = $('#editEmail').val();
    editUser.dateOfBirth = $('#editDateOfBirth').val();
    editUser.photo = $('#profilepictureedit').attr('src');
    var id = UserService.getID();

    $.ajax({
      url: ' rest/user/' + id,
      type: 'PUT',
      data: JSON.stringify(editUser),
      contentType: "application/json",
      dataType: "json",
      beforeSend: function (xhr) {
        xhr.setRequestHeader('Authorization', localStorage.getItem('token'));
      },
      success: function (result) {
          localStorage.setItem("profilePicture",editUser.photo);
          localStorage.setItem("name",editUser.name);
          localStorage.setItem("surname",editUser.surname);
          localStorage.setItem("username",editUser.username);
          localStorage.setItem("email",editUser.email);
          localStorage.setItem("dateOfBirth",editUser.dateOfBirth);
           $('#profilepictureedit').attr('src',localStorage.getItem("profilePicture"));
           $("#profileFirstName").text(localStorage.getItem("name"));
           $("#profileLastName").text(localStorage.getItem("surname"));
           $("#profileUsername").text(localStorage.getItem("username"));
           $("#profileEmail").text(localStorage.getItem("email"));
           $("#profileDateOfBirth").text(localStorage.getItem("dateOfBirth"));
           $("#mainUsername").text(localStorage.getItem("username"));

           $("#EditProfileModal").modal('hide');
      }
    });
  }

</script>
<script>

  function getPlaylists() {

    $.ajax({
      type: "GET",
      url: ' rest/playlists',
      beforeSend: function (xhr) {
        xhr.setRequestHeader('Authorization', localStorage.getItem('token'));
      },
      success: function (data) {
        $("#playlists").html("");
        var html = "";
        for (let i = 0; i < data.length; i++) {
          html += `
          <div class="col mt-3">
            <h4 class="text-center mt-5">`+data[i].name+`</h4>
             <a href="#" onClick="getPlaylistID(`+ data[i].id + `)">
              <img src="" id="`+data[i].id+`" class="img-fluid" style="width:400px; height:300px;"alt="playlistPicture">
               </a>
          </div>
            `;

        getSrc(data[i].id);
        $("#playlists").html(html);
        }


      }
    });
  }

  getPlaylists();


  function getSrc(id){

      var url
      $.ajax({
          type: "GET",
            url: ' rest/playlistsongs/' + id,
          beforeSend: function (xhr) {
              xhr.setRequestHeader('Authorization', localStorage.getItem('token'));
          },
          success: function (data) {
            for(var i=0;i<1;i++)
            {
                       $("#"+id).attr('src',data[i].cover + ".jpg");
            }

            }

      });
  }

  function getPlaylistID(id) {
    localStorage.setItem("playlistID", id);
    window.location.replace("playlists.html");
  }

  function deleteUser()
  {
    var id=UserService.getID();
    $.ajax({
        type: "DELETE",
        url: ' rest/user/ ' +id,
        beforeSend: function (xhr) {
            xhr.setRequestHeader('Authorization', localStorage.getItem('token'));
        },
        success: function (data) {
          localStorage.clear();
          window.location.replace("index.html");
        }
    });

  }

</script>

<!-- Modal HTML -->
<div id="deleteModal" class="modal fade">
	<div class="modal-dialog modal-confirm">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title w-100" style="text-align:center;">Are you sure?</h4>
			</div>
			<div class="modal-body">
				<p class="mt-3" align="center">This will remove your profile and all of your playlists.</p>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-info" data-bs-dismiss="modal">Cancel</button>
				<button type="button" class="btn btn-danger " onClick="deleteUser()">Delete</button>
			</div>
		</div>
	</div>
</div>

</html>
